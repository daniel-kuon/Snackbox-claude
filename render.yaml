# Render Blueprint: Snackbox

databases:
  - name: snackbox-postgres
    databaseName: snackboxdb
    # plan: standard (uncomment/adjust in Render if needed)
    # region: frankfurt
    ipAllowList: []

services:
  - type: web
    name: snackbox-api
    runtime: dotnet
    plan: free
    buildCommand: dotnet publish src/Snackbox.Api/Snackbox.Api.csproj -c Release -o out
    startCommand: dotnet out/Snackbox.Api.dll
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: DATABASE_URL
        fromDatabase:
          name: snackbox-postgres
          property: connectionString
      # Secrets to set in Render dashboard (do NOT commit values):
      # - key: JwtSettings__SecretKey
      # - key: JwtSettings__Issuer
      # - key: JwtSettings__Audience
      # - key: EmailSettings__Enabled
      # - key: EmailSettings__SmtpServer
      # - key: EmailSettings__SmtpPort
      # - key: EmailSettings__EnableSsl
      # - key: EmailSettings__Username
      # - key: EmailSettings__Password
      # - key: EmailSettings__FromEmail
      # - key: EmailSettings__FromName
      # - key: BarcodeLookup__ApiKey
      # - key: ALLOWED_ORIGINS  # comma-separated list, e.g. https://snackbox-web.onrender.com
    healthCheckPath: /health/ready

  - type: web
    name: snackbox-web
    runtime: dotnet
    plan: free
    buildCommand: dotnet publish src/Snackbox.BlazorServer/Snackbox.BlazorServer.csproj -c Release -o out
    startCommand: dotnet out/Snackbox.BlazorServer.dll
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      # Provide API base URL to the Blazor Server app
      - key: API_HTTPS
        fromService:
          name: snackbox-api
          type: web
          property: url
      # Alternatively, you can use API_URL instead of API_HTTPS
      # - key: API_URL
      #   fromService:
      #     name: snackbox-api
      #     type: web
      #     property: url
    healthCheckPath: /
